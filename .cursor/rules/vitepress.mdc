---
description: VitePress 2.0 项目开发规则
globs: 
alwaysApply: true
---

# VitePress 项目 Cursor Rules

## 项目概述

这是一个基于 VitePress 2.0.0-alpha.15 的文档站点项目，用于 TheBrain 知识库用户指南。

## 技术栈

- **框架**: VitePress 2.0.0-alpha.15 (基于 Vue 3.5)
- **运行时**: Node.js 22.21.1 (通过 Volta 管理)
- **包管理器**: pnpm
- **Markdown 检查**: markdownlint

## 项目结构

```
vitepress-project/
├── docs/                          # 文档目录 (VitePress 根目录)
│   ├── .vitepress/               # VitePress 配置目录
│   │   ├── config.ts             # 站点配置文件
│   │   ├── theme/                # 自定义主题
│   │   │   ├── index.ts          # 主题入口
│   │   │   ├── style.css         # 全局样式覆盖
│   │   │   └── components/       # 自定义 Vue 组件
│   │   └── dist/                 # 构建输出目录
│   ├── en/                       # 英文文档
│   ├── zh/                       # 中文文档 (待完善)
│   ├── public/                   # 静态资源
│   │   └── thebrain14-user-guide-images/  # 用户指南图片
│   └── index.md                  # 首页
├── package.json
└── pnpm-lock.yaml
```

## 开发命令

- `pnpm dev` - 启动开发服务器
- `pnpm build` - 构建生产版本
- `pnpm preview` - 预览构建结果
- `pnpm lint:md` - 检查 Markdown 格式
- `pnpm lint:md:fix` - 自动修复 Markdown 格式问题

## 编码规范

### VitePress 配置 (config.ts)

使用 `defineConfig` 进行类型安全的配置：

```typescript
import { defineConfig } from 'vitepress'

export default defineConfig({
  title: "站点标题",
  description: "站点描述",
  head: [
    ['link', { rel: 'icon', href: '/favicon.ico' }]
  ],
  themeConfig: {
    nav: [
      { text: 'Home', link: '/' },
      { text: 'Guide', link: '/guide/' }
    ],
    sidebar: [
      {
        text: '分组标题',
        items: [
          { text: '页面标题', link: '/path/to/page' }
        ]
      }
    ]
  },
  locales: {
    root: {
      label: 'English',
      lang: 'en'
    }
  }
})
```

### 多路径侧边栏配置

```typescript
export default {
  themeConfig: {
    sidebar: {
      '/guide/': [
        {
          text: '指南',
          items: [
            { text: '概述', link: '/guide/' },
            { text: '快速开始', link: '/guide/getting-started' }
          ]
        }
      ],
      '/config/': [
        {
          text: '配置',
          items: [
            { text: '概述', link: '/config/' }
          ]
        }
      ]
    }
  }
}
```

### Vue 组件开发

使用 Vue 3 Composition API 和 `<script setup>` 语法。组件放置在 `docs/.vitepress/theme/components/` 目录。

在 `docs/.vitepress/theme/index.ts` 中全局注册组件：

```typescript
import type { Theme } from 'vitepress'
import DefaultTheme from 'vitepress/theme'
import MyComponent from './components/MyComponent.vue'

export default {
  extends: DefaultTheme,
  enhanceApp({ app }) {
    app.component('MyComponent', MyComponent)
  }
} satisfies Theme
```

### 自定义主题与 Layout Slots

扩展默认主题并注入自定义内容到 Layout Slots：

```typescript
// .vitepress/theme/index.ts
import { h } from 'vue'
import type { Theme } from 'vitepress'
import DefaultTheme from 'vitepress/theme'
import MyComponent from './MyComponent.vue'

export default {
  extends: DefaultTheme,
  Layout() {
    return h(DefaultTheme.Layout, null, {
      'aside-outline-before': () => h(MyComponent)
    })
  }
} satisfies Theme
```

或使用 Vue 组件方式：

```vue
<!-- .vitepress/theme/MyLayout.vue -->
<script setup>
import DefaultTheme from 'vitepress/theme'
const { Layout } = DefaultTheme
</script>

<template>
  <Layout>
    <template #aside-outline-before>
      自定义内容
    </template>
  </Layout>
</template>
```

### 可用的 Layout Slots

- `doc-before` / `doc-after` - 文档内容前后
- `aside-top` / `aside-bottom` - 侧边栏顶部/底部
- `aside-outline-before` / `aside-outline-after` - 大纲前后
- `nav-bar-content-before` / `nav-bar-content-after` - 导航栏内容前后
- `sidebar-nav-before` / `sidebar-nav-after` - 侧边栏导航前后

### CSS 样式定制

优先使用 CSS 变量覆盖，在 `docs/.vitepress/theme/style.css` 中：

```css
:root {
  /* 品牌色 */
  --vp-c-brand-1: var(--vp-c-indigo-1);
  --vp-c-brand-2: var(--vp-c-indigo-2);
  --vp-c-brand-3: var(--vp-c-indigo-3);
  --vp-c-brand-soft: var(--vp-c-indigo-soft);

  /* 按钮样式 */
  --vp-button-brand-border: transparent;
  --vp-button-brand-text: var(--vp-c-white);
  --vp-button-brand-bg: var(--vp-c-brand-3);
  --vp-button-brand-hover-bg: var(--vp-c-brand-2);
}
```

## VitePress Runtime API

### useData Composable

访问页面特定数据：

```typescript
interface VitePressData<T = any> {
  site: Ref<SiteData<T>>       // 站点级元数据
  theme: Ref<T>                 // themeConfig
  page: Ref<PageData>           // 页面级元数据
  frontmatter: Ref<PageData['frontmatter']>  // 页面 frontmatter
  params: Ref<PageData['params']>            // 动态路由参数
  title: Ref<string>
  description: Ref<string>
  lang: Ref<string>
  isDark: Ref<boolean>
  dir: Ref<string>
  localeIndex: Ref<string>
  hash: Ref<string>             // 当前 location hash
}
```

使用示例：

```vue
<script setup>
import { useData } from 'vitepress'
const { theme, frontmatter, isDark } = useData()
</script>

<template>
  <h1>{{ theme.footer.copyright }}</h1>
</template>
```

### useRoute Composable

获取当前路由信息：

```typescript
interface Route {
  path: string
  data: PageData
  component: Component | null
}
```

### useRouter Composable

程序化导航：

```typescript
interface Router {
  route: Route
  go: (to?: string) => Promise<void>
  onBeforeRouteChange?: (to: string) => Awaitable<void | boolean>
  onBeforePageLoad?: (to: string) => Awaitable<void | boolean>
  onAfterPageLoad?: (to: string) => Awaitable<void>
  onAfterRouteChange?: (to: string) => Awaitable<void>
}
```

## Markdown 文档规范

### Frontmatter 配置

```yaml
---
title: 页面标题
description: 页面描述
layout: doc  # 可选: doc, home, page
sidebar: true  # 是否显示侧边栏
outline: [2, 3]  # 目录层级
prev:
  text: 上一页
  link: /previous
next:
  text: 下一页
  link: /next
---
```

### 文档规范

- 文档文件使用 kebab-case 命名 (如 `user-guide.md`)
- 图片引用使用绝对路径 `/thebrain14-user-guide-images/xxx.png`
- 支持 VitePress 内置容器：`::: tip`, `::: warning`, `::: danger`, `::: details`
- 可在 Markdown 中直接使用已注册的 Vue 组件

### 自定义容器语法

```markdown
::: tip 提示
这是一个提示
:::

::: warning 警告
这是一个警告
:::

::: danger 危险
这是一个危险提示
:::

::: details 点击查看详情
这是详情内容
:::
```

## 最佳实践

### 添加新文档页面

1. 在对应语言目录创建 `.md` 文件
2. 在 `config.ts` 的 `sidebar` 配置中添加链接
3. 如需导航栏入口，在 `nav` 中添加

### 添加新组件

1. 在 `docs/.vitepress/theme/components/` 创建 `.vue` 文件
2. 在 `docs/.vitepress/theme/index.ts` 中导入并注册
3. 在 Markdown 中直接使用组件标签

### 覆盖内部组件

使用 Vite 别名覆盖 VitePress 内部组件：

```typescript
import { fileURLToPath, URL } from 'node:url'
import { defineConfig } from 'vitepress'

export default defineConfig({
  vite: {
    resolve: {
      alias: [
        {
          find: /^.*\/VPNavBar\.vue$/,
          replacement: fileURLToPath(
            new URL('./components/CustomNavBar.vue', import.meta.url)
          )
        }
      ]
    }
  }
})
```

## 注意事项

- VitePress 2.0 仍处于 alpha 阶段，API 可能有变化
- 构建输出在 `docs/.vitepress/dist/`，已被 gitignore
- 缓存目录 `docs/.vitepress/cache/` 不应提交
- 使用 pnpm 而非 npm/yarn 安装依赖

## 常用导入

```typescript
// 配置
import { defineConfig } from 'vitepress'

// 主题
import DefaultTheme from 'vitepress/theme'
import type { Theme } from 'vitepress'

// 客户端 API
import { useData, useRoute, useRouter } from 'vitepress'

// Vue
import { h, ref, computed } from 'vue'
```

## 响应语言

请使用中文回复所有问题和说明。
